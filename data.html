<!DOCTYPE html>
<html lang="en">
<head>
  <title>Coffee Log</title>

  <!-- Libraries -->
  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css" rel="stylesheet">
  <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>

  <!-- StackMob Dependencies -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://static.stackmob.com/js/stackmob-js-0.8.0-bundled-min.js"></script>

  <!-- Site Dependencies -->
  <script type="text/javascript" src="site.js"></script>
  <link rel="stylesheet" href="site.css">

  <!-- Page Code -->
  <script type="text/javascript">
  /* <![CDATA[ */
    $(document).ready(function(){

      locations.query(qAll, {
      success: function(col){

        col.comparator = function(model) {
            return model.get('name');
        }
       col.sort().each(function(model){
          $("#locationsList").append(
            $('<option></option>').val(model.get('location_id')).html(model.get('name'))
          );
          
       });
     },
     error: function(){ console.log("bad locations query"); }
   });

    coffees.query(qAll, {
      success: function(col){
        col.comparator = function(model) {
            return model.get('name');
        }
       col.sort().each(function(model){
        $("#coffeesList").append(
          $('<option></option>').val(model.get('coffee_id')).html(model.get('name'))
        );
      })
       populateRoasts();
     },
     error: function(){ console.log("bad coffee query"); }
   });

    function populateRoasts(){
      $('#roastsList').html("");
      var selectedCoffee = $('#coffeesList').val();

      var roastsQuery = new StackMob.Collection.Query();
      roastsQuery.equals('coffee', selectedCoffee);
      roasts.query(roastsQuery, {
        success : function(col) {
          col.comparator = function(model) {
            return model.get('date');
        }
        console.log(col);
       col.sort().each(function(model){
        var newDate = new Date(parseInt(model.get('date')));
        console.log(newDate);
        $("#roastsList").append(
          $('<option></option>').val(model.get('roast_id')).html(newDate.getMonth() + "/" + newDate.getDate() + "/" + newDate.getFullYear())
        );
      })
        },
        error : function(model, response) {
          console.log(response);
        }
      });

    };

    function queryEspressoNotesBasedOnRoast(){
      if ($('#espresso_checkbox').is(':checked')) {
        console.log("Querying all espresso notes for roast date");
        var espressoNotesQuery = new StackMob.Collection.Query();
        espressoNotesQuery.equals('roast', $('#roastsList').val());
        espressoNotes.query(espressoNotesQuery, {
          success : function(model){

            console.log('Successfully got all espresso notes');
            queryDripNotesBasedOnRoast();
          },
          error : function(model, response){
            console.log(response);
          }
        });
      }
    };

    function queryDripNotesBasedOnRoast(){
      if ($('#drip_checkbox').is(':checked')) {
        console.log("Querying all drip notes for roast date");
        var dripNotesQuery = new StackMob.Collection.Query();
        dripNotesQuery.equals('roast', $('#roastsList').val());
        dripNotes.query(dripNotesQuery, {
          success : function(model){
            console.log('Successfully got all drip notes');
            querySiphonNotesBasedOnRoast();
          },
          error : function(model, response){
            console.log(response);
          }
        });
      }
    };

    function querySiphonNotesBasedOnRoast(){
      if ($('#siphon_checkbox').is(':checked')) {
        console.log("Querying all siphon notes for roast date");
        var siphonNotesQuery = new StackMob.Collection.Query();
        siphonNotesQuery.equals('roast', $('#roastsList').val());
        siphonNotes.query(siphonNotesQuery, {
          success : function(model){
            console.log('Successfully got all siphon notes');
          },
          error : function(model, response){
            console.log(response);
          }
        });
      }
    }

    $('#coffeesList').change(function(){
      console.log('Changes');
      populateRoasts();
    });

    $('#getNotesFromRoast').click(function(){
      
      queryEspressoNotesBasedOnRoast();
      
    });

  });
  /* ]]> */
  </script>

</head>
<body>

  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="#">Coffee Log</a>
        <div class="nav-collapse">
          <ul class="nav">
            <li><a href="/">Home</a></li>
            <li><a href="/admin.html">Admin</a></li>
            <li class="active"><a href="/data.html">Data</a></li>
            <li><a href="/login.html">Login</a></li>
            <li><a href="/login.html?logout=true">Logout</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
  </div>

  <h2>Get notes from a coffee's roast:</h2>
  <label>Choose Coffee:</label><select id="coffeesList"></select><br />
  <label>Choose Roast:</label><select id="roastsList"></select><br />
  <label>Type Of Note:</label>
    <input id="espresso_checkbox" type="checkbox">Espresso</input><br />
    <input id="drip_checkbox" type="checkbox">Drip</input><br />
    <input id="siphon_checkbox" type="checkbox">Siphon</input><br />
  <input id="getNotesFromRoast" class="btn btn-primary" type="button" value="Submit"></input>
  <br/>
  <br/>
  <br/>
  <table border=1 id="tableData">

    <tr>
      <th>Note ID</th>
      <th>Prep Date</th>
    </tr>

  </table>

  <!--
  <label>Locations:</label><select size='10' id="locationsList" multiple><option value="None">N/A</option></select><br />
  <label>Type:</label><select size='10' id="typeList" multiple><option value="None">N/A</option><option value="Espresso">Espresso</option><option value="Drip">Drip</option><option value="Siphon">Siphon</option></select><br />
  <label>Data:</label><select size='10' id="dataList" multiple></select><br />
-->
</body>
</html>
